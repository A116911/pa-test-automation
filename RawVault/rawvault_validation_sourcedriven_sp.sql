DECLARE @HUBQUERY NVARCHAR(MAX)
DECLARE @LINKQUERY NVARCHAR(MAX)
DECLARE @SATELLITEQUERY NVARCHAR(MAX)
DECLARE @TOTALHUB NVARCHAR(MAX)
DECLARE @TOTALLINK NVARCHAR(MAX)
DECLARE @TOTALSATELLITE NVARCHAR(MAX)
DECLARE @DATASOURCE NVARCHAR(MAX)
DECLARE @SOURCETABLE NVARCHAR(MAX)
DECLARE @FINALRVQUERYFORCOLUMNS NVARCHAR(MAX)
DECLARE @FINALRVQUERYFORTABLES NVARCHAR(MAX)
DECLARE @FINALSTAGINGQUERYFORCOLUMNS NVARCHAR(MAX)
DECLARE @FINALSTAGINGQUERY NVARCHAR(MAX)
--DECLARE @FINALSTAGINGQUERYFORCOLUMNS NTEXT
--DECLARE @FINALSTAGINGQUERY NTEXT
DECLARE @UPDATEDFINALRVQUERYFORCURRENTHUB NVARCHAR(MAX)
DECLARE @UPDATEDFINALRVQUERYFORALLHUB NVARCHAR(MAX)

--SET @DATASOURCE = 'CRM'
SET @SOURCETABLE = 'SCAPPTSEG'
DECLARE @HUBCOUNT NVARCHAR(MAX)
DECLARE @LINKCOUNT NVARCHAR(MAX)
DECLARE @SATELLITECOUNT NVARCHAR(MAX)

DECLARE @CHECKHUBCOUNTQUERY NVARCHAR(MAX)
DECLARE @CHECKLINKCOUNTQUERY NVARCHAR(MAX)
DECLARE @CHECKSATELLITECOUNTQUERY NVARCHAR(MAX)

DECLARE @HUBNAME NVARCHAR(MAX)
DECLARE @LINKNAME NVARCHAR(MAX)
DECLARE @SATNAME NVARCHAR(MAX)
DECLARE @HUBPRIMARYKEYCOUNT NVARCHAR(MAX)
DECLARE @HUBPRIMARYKEYVALUE NVARCHAR(MAX)
DECLARE @LINKPRIMARYKEYCOUNT NVARCHAR(MAX)
DECLARE @LINKPRIMARYKEYCOUNTFORTABLES NVARCHAR(MAX)
DECLARE @HUBDATACLASSIFICATION NVARCHAR(MAX)
DECLARE @LINKDATACLASSIFICATION NVARCHAR(MAX)
DECLARE @SATDATACLASSIFICATION NVARCHAR(MAX)
DECLARE @NONPRIMARYKEYCOUNT NVARCHAR(MAX)

DECLARE @QUERY1 NVARCHAR(MAX)
DECLARE @QUERY2 NVARCHAR(MAX)
DECLARE @QUERY3 NVARCHAR(MAX)
DECLARE @MERGEDQUERY NVARCHAR(MAX)
DECLARE @STAGINGQUERY NVARCHAR(MAX)


DECLARE @HUBLINKCOLUMN_TEMP NVARCHAR(MAX)
DECLARE @HUBLINKCOLUMN_FINAL NVARCHAR(MAX)
DECLARE @LINKSATCOLUMN_TEMP NVARCHAR(MAX)
DECLARE @LINKSATCOLUMN_FINAL NVARCHAR(MAX)
DECLARE @NONPRIMARYKEYCOLUMN_TEMP NVARCHAR(MAX)
DECLARE @NONPRIMARYKEYCOLUMN_FINAL NVARCHAR(MAX)
DECLARE @PRIMARYKEYVALUE_HUB NVARCHAR(MAX)
DECLARE @PRIMARYKEYVALUE_LINK NVARCHAR(MAX)
DECLARE @PRIMARYKEYVALUE_LINK_TABLEQUERY NVARCHAR(MAX)
DECLARE @NONPRIMARYKEYVALUE NVARCHAR(MAX)
DECLARE @ALLPRIMARYKEYCOLUMNS NVARCHAR(MAX)
DECLARE @NONPRIMARYCOLUMNLIST NVARCHAR(MAX)

DECLARE @HUBLINKTABLE_TEMP NVARCHAR(MAX)
DECLARE @HUBLINKTABLE_FINAL NVARCHAR(MAX)

DECLARE @LINKSATTABLE_TEMP NVARCHAR(MAX)
DECLARE @LINKSATTABLE_FINAL NVARCHAR(MAX)
DECLARE @LINKSATTABLE_FINAL_UPDATED NVARCHAR(MAX)
DECLARE @ALLCOLUMNS NVARCHAR(MAX)
DECLARE @MERGEDHUBTABLE NVARCHAR(MAX)
DECLARE @MERGEDLINKTABLE NVARCHAR(MAX)
DECLARE @MERGEDSATTABLE NVARCHAR(MAX)
DECLARE @FINALRAWVAULTQUERY_TEMP NVARCHAR(MAX)
DECLARE @FINALRAWVAULTQUERY_FINAL NVARCHAR(MAX)
--DECLARE @FINALRAWVAULTQUERY_TEMP NTEXT
--DECLARE @FINALRAWVAULTQUERY_FINAL NTEXT

DECLARE @PRIMARYKEYVALUE_HUB_STAGING NVARCHAR(MAX)
DECLARE @PRIMARYKEYVALUE_LINK_STAGING NVARCHAR(MAX)
DECLARE @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY NVARCHAR(MAX)
DECLARE @NONPRIMARYKEYVALUE_STAGING NVARCHAR(MAX)

DECLARE @DERIVEROWID NVARCHAR(MAX)

DECLARE @RECORDCOUNTINTABLECOLUMNSET NVARCHAR(MAX)
DECLARE @COLUMNVALUE_RAWVAULT_TEMP NVARCHAR(MAX)
DECLARE @COLUMNVALUE_RAWVAULT_FINAL NVARCHAR(MAX)
DECLARE @COLUMNVALUE_STAGING_TEMP NVARCHAR(MAX)
DECLARE @COLUMNVALUE_STAGING_FINAL NVARCHAR(MAX)
DECLARE @UPDATEDSTAGINGCOLUMNVALUE NVARCHAR(MAX)

DECLARE @SATPRIMARYKEYCOUNTUNDERTHELINK NVARCHAR(MAX)

DECLARE @HUBSATCOLUMN_TEMP NVARCHAR(MAX)
DECLARE @HUBSATCOLUMN_FINAL NVARCHAR(MAX)
DECLARE @HUBSATTABLE_TEMP NVARCHAR(MAX)
DECLARE @HUBSATTABLE_FINAL NVARCHAR(MAX)

DECLARE @PRIMARYKEYITERATOR_HUB INT = 1
DECLARE @PRIMARYKEYITERATOR_LINK INT = 1
DECLARE @PRIMARYKEYITERATORFORLINKTABLES INT
DECLARE @NONPRIMARYKEYITERATOR INT = 1

DECLARE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR INT

DECLARE @TARGETFIELDNAME_HUBLINK_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAME_HUBLINK_TEMP NVARCHAR(MAX)
DECLARE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR INT
DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK NVARCHAR(MAX) 

DECLARE @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLECOUNT_HUBLINK_ITERATOR INT
DECLARE @TARGETTABLECOUNT_HUBLINK NVARCHAR(MAX) 

DECLARE @TARGETFIELDNAME_LINKSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAME_LINKSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR INT
DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT NVARCHAR(MAX) 

DECLARE @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLECOUNT_LINKSAT_ITERATOR INT
DECLARE @TARGETTABLECOUNT_LINKSAT NVARCHAR(MAX) 

DECLARE @TARGETFIELDNAME_NONPK_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAME_NONPK_TEMP NVARCHAR(MAX)
DECLARE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR INT
DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK NVARCHAR(MAX)

DECLARE @TARGETFIELDNAME_HUBSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAME_HUBSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR INT
DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT NVARCHAR(MAX) 

DECLARE @TARGETFIELDNAMEFORTABLE_HUBSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLENAMEFORTABLE_HUBSAT_TEMP NVARCHAR(MAX)
DECLARE @TARGETTABLECOUNT_HUBSAT_ITERATOR INT
DECLARE @TARGETTABLECOUNT_HUBSAT NVARCHAR(MAX) 

DECLARE @SATCOUNTUNDERLINK NVARCHAR(MAX)
DECLARE @SATUNDERLINKITERATOR INT

BEGIN
	BEGIN TRY
		DROP TABLE #TABLE_WORKINGSET
	END TRY
	BEGIN CATCH
		PRINT '#TABLE_WORKINGSET IS NOT PRESENT IN THE SCHEMA'
	END CATCH;

	--BEGIN TRY
	--	DROP TABLE #PRIMARYKEYRESULTSET
	--END TRY
	--BEGIN CATCH
	--	PRINT '#PRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
	--END CATCH;

	--BEGIN TRY
	--	DROP TABLE #NONPRIMARYKEYRESULTSET
	--END TRY
	--BEGIN CATCH
	--	PRINT '#NONPRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
	--END CATCH;

	--BEGIN TRY
	--	DROP TABLE #TABLE_COLUMNSET
	--END TRY
	--BEGIN CATCH
	--	PRINT '#TABLE_COLUMNSET IS NOT PRESENT IN THE SCHEMA'
	--END CATCH;

	--BEGIN TRY
	--	DROP TABLE #TABLE_COLUMNSET_UPDATED
	--END TRY
	--BEGIN CATCH
	--	PRINT '#TABLE_COLUMNSET_UPDATED IS NOT PRESENT IN THE SCHEMA'
	--END CATCH;

	CREATE TABLE #TABLE_WORKINGSET WITH (DISTRIBUTION = ROUND_ROBIN) AS SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS REFROWID,SOURCEFIELDNAME,SOURCETABLENAME,TARGETFIELDNAME,TARGETTABLENAME,TARGETSCHEMA,ISPRIMARYKEY FROM [STAGING].[SOURCE_TARGET_MAPPING]
	WHERE SOURCETABLENAME LIKE '%'+ @SOURCETABLE +'%'

	SET @TOTALHUB = (SELECT COUNT(DISTINCT(TARGETTABLENAME)) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'HUB%')
	SET @TOTALLINK = (SELECT COUNT(DISTINCT(TARGETTABLENAME)) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'LINK%')
	SET @TOTALSATELLITE = (SELECT COUNT(DISTINCT(TARGETTABLENAME)) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%')

	PRINT('@TOTALHUB:: ' + @TOTALHUB + '; @TOTALLINK:: ' + @TOTALLINK + '; @TOTALSATELLITE::' + @TOTALSATELLITE)

	DECLARE @HUBITERATOR INT = 1;

	SET @TOTALHUB = CAST(@TOTALHUB AS INT)

	IF (@TOTALHUB = 0)
		BEGIN
			BEGIN TRY
				DROP TABLE #PRIMARYKEYRESULTSET
			END TRY
			BEGIN CATCH
				PRINT '#PRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
			END CATCH;

			BEGIN TRY
				DROP TABLE #NONPRIMARYKEYRESULTSET
			END TRY
			BEGIN CATCH
				PRINT '#NONPRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
			END CATCH;

			BEGIN TRY
				DROP TABLE #TABLE_COLUMNSET
			END TRY
			BEGIN CATCH
				PRINT '#TABLE_COLUMNSET IS NOT PRESENT IN THE SCHEMA'
			END CATCH;

			BEGIN TRY
				DROP TABLE #TABLE_COLUMNSET_UPDATED
			END TRY
			BEGIN CATCH
				PRINT '#TABLE_COLUMNSET_UPDATED IS NOT PRESENT IN THE SCHEMA'
			END CATCH;

			SET @PRIMARYKEYITERATOR_LINK = 1
			SET @PRIMARYKEYITERATORFORLINKTABLES = 1
			SET @NONPRIMARYKEYITERATOR = 1

			SET @LINKNAME = (SELECT DISTINCT(RESULTQUERY.TARGETTABLENAME) FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,COUNT(TARGETTABLENAME) AS PRIMARYKEYCOUNT FROM #TABLE_WORKINGSET GROUP BY TARGETTABLENAME HAVING TARGETTABLENAME LIKE 'LINK%') AS RESULTQUERY)
			SET @LINKDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)

			--SET @SATCOUNTFORLINK = (SELECT COUNT(DISTINCT(RESULTQUERY.TARGETTABLENAME)) FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT FARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TABLENAME LIKE @LINKNAME)) AS RESULTQUERY)

			--SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,COUNT(TARGETTABLENAME) AS PRIMARYKEYCOUNT FROM #TABLE_WORKINGSET GROUP BY TARGETTABLENAME HAVING TARGETTABLENAME LIKE 'SAT%') AS RESULTQUERY)
			SET @SATNAME = (SELECT DISTINCT(RESULTQUERY.TARGETTABLENAME) FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
			SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

			CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

			CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

			CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(4000),SOURCEFIELDNAME NVARCHAR(4000),TARGETFIELDNAME NVARCHAR(4000))

			--SET @HUBPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'HUB%' AND TARGETTABLENAME LIKE @HUBNAME)
			--SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
			SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)
			SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)
			SET @NONPRIMARYKEYCOUNT = (SELECT COUNT(TARGETFIELDNAME) FROM #NONPRIMARYKEYRESULTSET)
	
			SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1

			--START:: COLUMNS PRESENT IN LINK AND SATELLITE
			WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
			BEGIN
				SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
				SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

				PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

				-- START:: COLUMN CREATION SECTION
				SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
				SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
				SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

				WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
				BEGIN
					SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
					SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

					IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
						SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
					ELSE
						SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

					SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
				END

				--SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK
				SET @LINKSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @LINKSATCOLUMN_TEMP + '),'''')AS ' + @PRIMARYKEYVALUE_LINK
				SET @PRIMARYKEYVALUE_LINK_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_LINK_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_LINK_STAGING


				INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP )

				SET @LINKSATCOLUMN_TEMP = NULL
				-- CLOSE:: COLUMN CREATION SECTION

				SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
			END
			--CLOSE:: COLUMNS PRESENT IN LINK AND SATELLITE
		
			--START:: TABLES PRESENT IN LINK AND SATELLITE
			SET @PRIMARYKEYITERATORFORLINKTABLES = 1

			WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @LINKPRIMARYKEYCOUNTFORTABLES
			BEGIN
				SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
				SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

				PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

				-- START:: TABLE CREATION SECTION
				SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1

				SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
				SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

				WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
				BEGIN
					SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
					SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

					IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
						SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
					ELSE
						SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

					SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
				END

				IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
					SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
				ELSE
					SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

				SET @LINKSATTABLE_TEMP = NULL
				-- CLOSE:: TABLE CREATION SECTION

				SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
			END
			--CLOSE:: TABLES PRESENT IN LINK AND SATELLITE

			PRINT('@LINKSATTABLE_FINAL FOR HUB ' + @HUBNAME + ' IS ' + @LINKSATTABLE_FINAL)

			--START:: NON PRIMARY COLUMNS
			SET @NONPRIMARYKEYITERATOR = 1

			WHILE @NONPRIMARYKEYITERATOR <= @NONPRIMARYKEYCOUNT
			BEGIN
				SET @NONPRIMARYKEYVALUE = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )
				SET @NONPRIMARYKEYVALUE_STAGING = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )

				PRINT('@NONPRIMARYKEYVALUE:: ' + @NONPRIMARYKEYVALUE)

				--SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
				--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
				--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

				--WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
				--BEGIN
				--	SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
				--	SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

				--	IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
				--		SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
				--	ELSE
				--		SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

				--	SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
				--END

			
				--INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)

				SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
				SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
				SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

				IF NOT ((@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1) AND (CHARINDEX(@NONPRIMARYKEYVALUE,@NONPRIMARYCOLUMNLIST) > 1))
					BEGIN
						WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
						BEGIN
							SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
							SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

							IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
								SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
							ELSE
								SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

							SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
						END

						IF(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1)
							BEGIN
								SET @NONPRIMARYKEYCOLUMN_TEMP = 'COALESCE(' + @NONPRIMARYKEYCOLUMN_TEMP + ') AS ' + @TARGETFIELDNAME_NONPK_TEMP
							END
						ELSE
							BEGIN
								SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
							END

						--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
						--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

						--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

						SET @NONPRIMARYCOLUMNLIST = @NONPRIMARYCOLUMNLIST + @NONPRIMARYKEYVALUE
			
						INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)		
					END

				SET @NONPRIMARYKEYCOLUMN_TEMP = NULL

				SET @NONPRIMARYKEYITERATOR = @NONPRIMARYKEYITERATOR + 1
			END
			--CLOSE:: NON PRIMARY COLUMNS

			CREATE TABLE #TABLE_COLUMNSET_UPDATED WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT *,ROW_NUMBER() OVER (ORDER BY IDENTIFIER) AS ROW_NUM FROM #TABLE_COLUMNSET)


			SET @RECORDCOUNTINTABLECOLUMNSET = (SELECT COUNT(IDENTIFIER) FROM #TABLE_COLUMNSET_UPDATED)
			SET @RECORDCOUNTINTABLECOLUMNSET = CAST(@RECORDCOUNTINTABLECOLUMNSET AS INT)

			SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1

			WHILE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR <= @RECORDCOUNTINTABLECOLUMNSET
			BEGIN
				SET @COLUMNVALUE_RAWVAULT_TEMP = (SELECT TARGETFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)
				SET @COLUMNVALUE_STAGING_TEMP = (SELECT SOURCEFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)

				IF (CAST((SELECT LEN(@COLUMNVALUE_RAWVAULT_FINAL)) AS INT) > 0)
					SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_FINAL + ',' + @COLUMNVALUE_RAWVAULT_TEMP
				ELSE
					SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_TEMP 

				IF (CAST((SELECT LEN(@COLUMNVALUE_STAGING_FINAL)) AS INT) > 0)
					SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_FINAL + ',' + @COLUMNVALUE_STAGING_TEMP
				ELSE
					SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_TEMP

				SET @COLUMNVALUE_RAWVAULT_TEMP = NULL
				SET @COLUMNVALUE_STAGING_TEMP = NULL

				SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = @RECORDCOUNTINTABLECOLUMNSET_ITERATOR + 1
			END

			PRINT('@COLUMNVALUE_RAWVAULT_FINAL:: ' + @COLUMNVALUE_RAWVAULT_FINAL)
			PRINT('@COLUMNVALUE_STAGING_FINAL:: ' + @COLUMNVALUE_STAGING_FINAL)


			SET @MERGEDLINKTABLE = @LINKDATACLASSIFICATION + '.' + @LINKNAME
			SET @MERGEDSATTABLE = @SATDATACLASSIFICATION + '.' + @SATNAME

			PRINT('@ALLCOLUMNS:: ' + @ALLCOLUMNS)
			PRINT('@MERGEDHUBTABLE' + @MERGEDHUBTABLE)
			PRINT('@MERGEDLINKTABLE' + @MERGEDLINKTABLE)
			PRINT('@MERGEDSATTABLE' + @MERGEDSATTABLE)

			SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDLINKTABLE + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @LINKSATTABLE_FINAL + ')')

			IF (CAST((SELECT LEN(@FINALRAWVAULTQUERY_FINAL)) AS INT) > 0)
				SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_FINAL + ' UNION ' + @FINALRAWVAULTQUERY_TEMP
			ELSE
				SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_TEMP


			PRINT('@FINALRAWVAULTQUERY_TEMP:: ' + @FINALRAWVAULTQUERY_TEMP)
			PRINT('@FINALRAWVAULTQUERY_FINAL:: ' + @FINALRAWVAULTQUERY_FINAL)

		
			SET @UPDATEDSTAGINGCOLUMNVALUE = @COLUMNVALUE_STAGING_FINAL 

			PRINT('@UPDATEDSTAGINGCOLUMNVALUE INSIDE LOOP::' + @UPDATEDSTAGINGCOLUMNVALUE)
		

			SET @HUBLINKCOLUMN_FINAL = NULL
			SET @LINKSATCOLUMN_FINAL = NULL
			SET @NONPRIMARYKEYCOLUMN_FINAL = NULL
			SET @HUBLINKTABLE_FINAL = NULL
			SET @LINKSATTABLE_FINAL = NULL
			SET @ALLPRIMARYKEYCOLUMNS = NULL
			SET @ALLCOLUMNS = NULL
			SET @MERGEDHUBTABLE = NULL
			SET @MERGEDLINKTABLE = NULL
			SET @MERGEDSATTABLE = NULL
			SET @FINALRAWVAULTQUERY_TEMP = NULL
			SET @COLUMNVALUE_RAWVAULT_FINAL = NULL
			SET @COLUMNVALUE_STAGING_FINAL = NULL
		END
	ELSE
		BEGIN
			WHILE @HUBITERATOR <= @TOTALHUB
			BEGIN
				BEGIN TRY
					DROP TABLE #PRIMARYKEYRESULTSET
				END TRY
				BEGIN CATCH
					PRINT '#PRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
				END CATCH;

				BEGIN TRY
					DROP TABLE #NONPRIMARYKEYRESULTSET
				END TRY
				BEGIN CATCH
					PRINT '#NONPRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
				END CATCH;

				BEGIN TRY
					DROP TABLE #TABLE_COLUMNSET
				END TRY
				BEGIN CATCH
					PRINT '#TABLE_COLUMNSET IS NOT PRESENT IN THE SCHEMA'
				END CATCH;

				BEGIN TRY
					DROP TABLE #TABLE_COLUMNSET_UPDATED
				END TRY
				BEGIN CATCH
					PRINT '#TABLE_COLUMNSET_UPDATED IS NOT PRESENT IN THE SCHEMA'
				END CATCH;

		
				--DECLARE @PRIMARYKEYITERATOR_HUB INT = 1
				--DECLARE @PRIMARYKEYITERATOR_LINK INT = 1
				--DECLARE @PRIMARYKEYITERATORFORLINKTABLES INT
				--DECLARE @NONPRIMARYKEYITERATOR INT = 1

				--DECLARE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR INT

				--DECLARE @TARGETFIELDNAME_HUBLINK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAME_HUBLINK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR INT
				--DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK NVARCHAR(1000) 

				--DECLARE @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLECOUNT_HUBLINK_ITERATOR INT
				--DECLARE @TARGETTABLECOUNT_HUBLINK NVARCHAR(1000) 

				--DECLARE @TARGETFIELDNAME_LINKSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAME_LINKSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR INT
				--DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT NVARCHAR(1000) 

				--DECLARE @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLECOUNT_LINKSAT_ITERATOR INT
				--DECLARE @TARGETTABLECOUNT_LINKSAT NVARCHAR(1000) 

				--DECLARE @TARGETFIELDNAME_NONPK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAME_NONPK_TEMP NVARCHAR(2000)
				--DECLARE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR INT
				--DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK NVARCHAR(1000)

				--DECLARE @TARGETFIELDNAME_HUBSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAME_HUBSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR INT
				--DECLARE @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT NVARCHAR(1000) 

				--DECLARE @TARGETFIELDNAMEFORTABLE_HUBSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLENAMEFORTABLE_HUBSAT_TEMP NVARCHAR(2000)
				--DECLARE @TARGETTABLECOUNT_HUBSAT_ITERATOR INT
				--DECLARE @TARGETTABLECOUNT_HUBSAT NVARCHAR(1000) 

				--DECLARE @SATCOUNTUNDERLINK NVARCHAR(1000)
				--DECLARE @SATUNDERLINKITERATOR INT

				CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

				CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

				CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(4000),SOURCEFIELDNAME NVARCHAR(4000),TARGETFIELDNAME NVARCHAR(4000))

				SET @HUBNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,COUNT(TARGETTABLENAME) AS PRIMARYKEYCOUNT FROM #TABLE_WORKINGSET GROUP BY TARGETTABLENAME HAVING TARGETTABLENAME LIKE 'HUB%') AS RESULTQUERY WHERE RESULTQUERY.SEQUENCE = @HUBITERATOR)
				SET @HUBDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)

				SET @HUBPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'HUB%' AND TARGETTABLENAME LIKE @HUBNAME)
				SET @NONPRIMARYKEYCOUNT = (SELECT COUNT(TARGETFIELDNAME) FROM #NONPRIMARYKEYRESULTSET)

				PRINT('@HUBDATACLASSIFICATION.@HUBNAME:: ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME)

				--SET @LINKNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS RESULTQUERY)
				SET @LINKCOUNT = (SELECT COUNT(DISTINCT(TARGETTABLENAME)) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME))
				SET @LINKCOUNT = CAST(@LINKCOUNT AS INT)
				PRINT('@LINKCOUNT:: ' + @LINKCOUNT)

				IF (@LINKCOUNT > 1)
					BEGIN
						DECLARE @ALLLINKUNDERHUBITERATOR INT = 1

						WHILE @ALLLINKUNDERHUBITERATOR <= @LINKCOUNT
						BEGIN
							BEGIN TRY
								DROP TABLE #TABLE_COLUMNSET_UPDATED
							END TRY

							BEGIN CATCH
								PRINT '#TABLE_COLUMNSET_UPDATED IS NOT PRESENT IN THE SCHEMA'
							END CATCH;

							SET @LINKNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS RESULTQUERY WHERE RESULTQUERY.SEQUENCE LIKE @ALLLINKUNDERHUBITERATOR)
							SET @LINKDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)

							SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
							SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)

							PRINT('@LINKDATACLASSIFICATION.@LINKNAME:: ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME)


							--START:: COLUMNS PRESENT IN HUB AND LINK
							SET @PRIMARYKEYITERATOR_HUB = 1

							WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
							BEGIN
								SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
								SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

								PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

								-- START:: COLUMN CREATION SECTION
								SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = 1 
			
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME)))
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK AS INT)

								WHILE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK
								BEGIN
									SET @TARGETFIELDNAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)
									SET @TARGETTABLENAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)

									IF (CAST((SELECT LEN(@HUBLINKCOLUMN_TEMP)) AS INT) > 0)
										SET @HUBLINKCOLUMN_TEMP = @HUBLINKCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP
									ELSE
										SET @HUBLINKCOLUMN_TEMP = @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP

									SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR +	1
								END

								--SET @HUBLINKCOLUMN_TEMP = 'COALESCE(' + @HUBLINKCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB
								SET @HUBLINKCOLUMN_TEMP = 'ISNULL(COALESCE(' + @HUBLINKCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_HUB
								SET @PRIMARYKEYVALUE_HUB_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_HUB_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_HUB_STAGING


								INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBLINKCOLUMN_TEMP)

								SET @HUBLINKCOLUMN_TEMP = NULL
								-- END:: COLUMN CREATION SECTION

								-- START:: TABLE CREATION SECTION
								SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = 1

								SET @TARGETTABLECOUNT_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%') AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME)))
								SET @TARGETTABLECOUNT_HUBLINK = CAST(@TARGETTABLECOUNT_HUBLINK AS INT)

								WHILE @TARGETTABLECOUNT_HUBLINK_ITERATOR <= @TARGETTABLECOUNT_HUBLINK
								BEGIN
									SET @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%') AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)
									SET @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%') AND ((TARGETTABLENAME LIKE @HUBNAME) OR (TARGETTABLENAME LIKE @LINKNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)

									IF (CAST((SELECT LEN(@HUBLINKTABLE_TEMP)) AS INT) > 0)
										SET @HUBLINKTABLE_TEMP = @HUBLINKTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP
									ELSE
										SET @HUBLINKTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP

									SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = @TARGETTABLECOUNT_HUBLINK_ITERATOR +	1
								END
			
								IF (CAST((SELECT LEN(@HUBLINKTABLE_FINAL)) AS INT) > 0)
									SET @HUBLINKTABLE_FINAL = @HUBLINKTABLE_FINAL + ' AND ' + @HUBLINKTABLE_TEMP
								ELSE
									SET @HUBLINKTABLE_FINAL = ' ON ' + @HUBLINKTABLE_TEMP

								SET @HUBLINKTABLE_TEMP = NULL
								-- END:: TABLE CREATION SECTION

								SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
							END
							--END:: COLUMNS PRESENT IN HUB AND LINK

							--START:: COLUMNS PRESENT IN LINK AND SATELLITE
							SET @PRIMARYKEYITERATOR_LINK = 1
							WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
							BEGIN
								SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
								SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

								PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

								-- START:: COLUMN CREATION SECTION
								SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

								WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
								BEGIN
									SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
									SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

									IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
										SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
									ELSE
										SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

									SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
								END

								--SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK
								SET @LINKSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @LINKSATCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_LINK
								SET @PRIMARYKEYVALUE_LINK_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_LINK_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_LINK_STAGING


								INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

								SET @LINKSATCOLUMN_TEMP = NULL
								-- END:: COLUMN CREATION SECTION

								SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
							END
							--END:: COLUMNS PRESENT IN LINK AND SATELLITE

					
							SET @SATCOUNTUNDERLINK = (SELECT COUNT(DISTINCT(RESULTQUERY.TARGETTABLENAME)) FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
							SET @SATCOUNTUNDERLINK = CAST(@SATCOUNTUNDERLINK AS INT)

							PRINT('@SATCOUNTUNDERLINK:: ' + @SATCOUNTUNDERLINK)

							SET @SATUNDERLINKITERATOR = 1

							IF (@SATCOUNTUNDERLINK > 1)
								BEGIN
									WHILE @SATUNDERLINKITERATOR <= @SATCOUNTUNDERLINK
									BEGIN
										/*BEGIN TRY
											DROP TABLE #PRIMARYKEYRESULTSET
										END TRY
										BEGIN CATCH
											PRINT '#PRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
										END CATCH;

										BEGIN TRY
											DROP TABLE #NONPRIMARYKEYRESULTSET
										END TRY
										BEGIN CATCH
											PRINT '#NONPRIMARYKEYRESULTSET IS NOT PRESENT IN THE SCHEMA'
										END CATCH;

										BEGIN TRY
											DROP TABLE #TABLE_COLUMNSET
										END TRY
										BEGIN CATCH
											PRINT '#TABLE_COLUMNSET IS NOT PRESENT IN THE SCHEMA'
										END CATCH;

										BEGIN TRY
											DROP TABLE #TABLE_COLUMNSET_UPDATED
										END TRY
										BEGIN CATCH
											PRINT '#TABLE_COLUMNSET_UPDATED IS NOT PRESENT IN THE SCHEMA'
										END CATCH;*/

										--SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
										--SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY WHERE RESULTQUERY.SEQUENCE LIKE @SATCOUNTUNDERLINK)
										SET @SATNAME = (SELECT FINALRESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY) AS FINALRESULTQUERY WHERE FINALRESULTQUERY.SEQUENCE LIKE @SATUNDERLINKITERATOR)
										SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

										PRINT('@SATDATACLASSIFICATION.@SATNAME:: ' + @SATDATACLASSIFICATION + '.' + @SATNAME)

										/*CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

										CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

										CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(2000),SOURCEFIELDNAME NVARCHAR(2000),TARGETFIELDNAME NVARCHAR(2000))*/

										--SET @HUBPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'HUB%' AND TARGETTABLENAME LIKE @HUBNAME)
										--SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
										--SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)
										--SET @NONPRIMARYKEYCOUNT = (SELECT COUNT(TARGETFIELDNAME) FROM #NONPRIMARYKEYRESULTSET)
	
										--SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1

										/*--START:: COLUMNS PRESENT IN HUB AND LINK
										WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
										BEGIN
											SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
											SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

											PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

											-- START:: COLUMN CREATION SECTION
											SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = 1 
			
											SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB)
											SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK AS INT)

											WHILE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK
											BEGIN
												SET @TARGETFIELDNAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)
												SET @TARGETTABLENAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)

												IF (CAST((SELECT LEN(@HUBLINKCOLUMN_TEMP)) AS INT) > 0)
													SET @HUBLINKCOLUMN_TEMP = @HUBLINKCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP
												ELSE
													SET @HUBLINKCOLUMN_TEMP = @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP

												SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR +	1
											END

											SET @HUBLINKCOLUMN_TEMP = 'COALESCE(' + @HUBLINKCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB


											INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBLINKCOLUMN_TEMP)

											SET @HUBLINKCOLUMN_TEMP = NULL
											-- END:: COLUMN CREATION SECTION

											-- START:: TABLE CREATION SECTION
											SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = 1

											SET @TARGETTABLECOUNT_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%'))
											SET @TARGETTABLECOUNT_HUBLINK = CAST(@TARGETTABLECOUNT_HUBLINK AS INT)

											WHILE @TARGETTABLECOUNT_HUBLINK_ITERATOR <= @TARGETTABLECOUNT_HUBLINK
											BEGIN
												SET @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)
												SET @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)

												IF (CAST((SELECT LEN(@HUBLINKTABLE_TEMP)) AS INT) > 0)
													SET @HUBLINKTABLE_TEMP = @HUBLINKTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP
												ELSE
													SET @HUBLINKTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP

												SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = @TARGETTABLECOUNT_HUBLINK_ITERATOR +	1
											END
			
											IF (CAST((SELECT LEN(@HUBLINKTABLE_FINAL)) AS INT) > 0)
												SET @HUBLINKTABLE_FINAL = @HUBLINKTABLE_FINAL + ' AND ' + @HUBLINKTABLE_TEMP
											ELSE
												SET @HUBLINKTABLE_FINAL = ' ON ' + @HUBLINKTABLE_TEMP

											SET @HUBLINKTABLE_TEMP = NULL
											-- END:: TABLE CREATION SECTION

											SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
										END
										--END:: COLUMNS PRESENT IN HUB AND LINK*/

										/*--START:: COLUMNS PRESENT IN LINK AND SATELLITE
										WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
										BEGIN
											SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
											SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

											PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

											-- START:: COLUMN CREATION SECTION
											SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
											SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
											SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

											WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
											BEGIN
												SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
												SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

												IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
													SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
												ELSE
													SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

												SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
											END

											SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK


											INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

											SET @LINKSATCOLUMN_TEMP = NULL
											-- END:: COLUMN CREATION SECTION

											SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
										END
										--END:: COLUMNS PRESENT IN LINK AND SATELLITE*/

										SET @PRIMARYKEYITERATORFORLINKTABLES = 1
										SET @SATPRIMARYKEYCOUNTUNDERTHELINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME)
										SET @SATPRIMARYKEYCOUNTUNDERTHELINK = CAST(@SATPRIMARYKEYCOUNTUNDERTHELINK AS INT)
		
										/*--START:: TABLES PRESENT IN LINK AND SATELLITE
										WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @LINKPRIMARYKEYCOUNTFORTABLES
										BEGIN
											SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
											SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

											PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

											-- START:: TABLE CREATION SECTION
											SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1 

											SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME)))
											--SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
											SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

											WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
											BEGIN
												--SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
												--SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

												SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
												SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

												IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
													SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
												ELSE
													SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

												SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
											END

											IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
												SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
											ELSE
												SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

											SET @LINKSATTABLE_TEMP = NULL
											-- END:: TABLE CREATION SECTION

											SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
										END
										--END:: TABLES PRESENT IN LINK AND SATELLITE*/

										--START:: TABLES PRESENT IN LINK AND SATELLITE
										SET @PRIMARYKEYITERATORFORLINKTABLES = 1

										WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @SATPRIMARYKEYCOUNTUNDERTHELINK
										BEGIN
											SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
											SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

											PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

											-- START:: TABLE CREATION SECTION
											SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1

											SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME)))
											--SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
											SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

											WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
											BEGIN
												SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
												SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

												IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
													SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
												ELSE
													SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

												SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
											END

											IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
												SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
											ELSE
												SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

											SET @LINKSATTABLE_TEMP = NULL
											-- END:: TABLE CREATION SECTION

											SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
										END
										--END:: TABLES PRESENT IN LINK AND SATELLITE

										IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL_UPDATED)) AS INT) > 0)
											SET @LINKSATTABLE_FINAL_UPDATED = @LINKSATTABLE_FINAL_UPDATED + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL
										ELSE
											SET @LINKSATTABLE_FINAL_UPDATED = ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL

										SET @LINKSATTABLE_FINAL = NULL

										SET @SATUNDERLINKITERATOR = @SATUNDERLINKITERATOR + 1
									END

									--IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL_UPDATED)) AS INT) > 0)
									--	SET @LINKSATTABLE_FINAL_UPDATED = @LINKSATTABLE_FINAL_UPDATED + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL
									--ELSE
									--	SET @LINKSATTABLE_FINAL_UPDATED = ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL

									PRINT('@LINKSATTABLE_FINAL_UPDATED:: ' + @LINKSATTABLE_FINAL_UPDATED)

									PRINT('FULL QUERY OF HUB LINK AND SATELLITE TABLE:: ' + 'FROM ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME + ' INNER JOIN ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME + @LINKSATTABLE_FINAL_UPDATED)
								END
							ELSE
								BEGIN
									--SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
									SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
									SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

									PRINT('@SATDATACLASSIFICATION.@SATNAME:: ' + @SATDATACLASSIFICATION + '.' + @SATNAME)

									--CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

									--CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

									--CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(2000),SOURCEFIELDNAME NVARCHAR(2000),TARGETFIELDNAME NVARCHAR(2000))

									SET @HUBPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'HUB%' AND TARGETTABLENAME LIKE @HUBNAME)
									SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
									SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)
									SET @NONPRIMARYKEYCOUNT = (SELECT COUNT(TARGETFIELDNAME) FROM #NONPRIMARYKEYRESULTSET)

									--START:: COLUMNS PRESENT IN HUB AND LINK
									SET @PRIMARYKEYITERATOR_HUB = 1

									WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
									BEGIN
										SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
										SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

										PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

										-- START:: COLUMN CREATION SECTION
										SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = 1 
			
										SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB)
										SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK AS INT)

										WHILE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK
										BEGIN
											SET @TARGETFIELDNAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)
											SET @TARGETTABLENAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)

											IF (CAST((SELECT LEN(@HUBLINKCOLUMN_TEMP)) AS INT) > 0)
												SET @HUBLINKCOLUMN_TEMP = @HUBLINKCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP
											ELSE
												SET @HUBLINKCOLUMN_TEMP = @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP

											SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR +	1
										END

										--SET @HUBLINKCOLUMN_TEMP = 'COALESCE(' + @HUBLINKCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB
										SET @HUBLINKCOLUMN_TEMP = 'ISNULL(COALESCE(' + @HUBLINKCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_HUB
										SET @PRIMARYKEYVALUE_HUB_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_HUB_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_HUB_STAGING


										INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBLINKCOLUMN_TEMP)

										SET @HUBLINKCOLUMN_TEMP = NULL
										-- END:: COLUMN CREATION SECTION

										-- START:: TABLE CREATION SECTION
										SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = 1

										SET @TARGETTABLECOUNT_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%'))
										SET @TARGETTABLECOUNT_HUBLINK = CAST(@TARGETTABLECOUNT_HUBLINK AS INT)

										WHILE @TARGETTABLECOUNT_HUBLINK_ITERATOR <= @TARGETTABLECOUNT_HUBLINK
										BEGIN
											SET @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)
											SET @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)

											IF (CAST((SELECT LEN(@HUBLINKTABLE_TEMP)) AS INT) > 0)
												SET @HUBLINKTABLE_TEMP = @HUBLINKTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP
											ELSE
												SET @HUBLINKTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP

											SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = @TARGETTABLECOUNT_HUBLINK_ITERATOR +	1
										END
			
										IF (CAST((SELECT LEN(@HUBLINKTABLE_FINAL)) AS INT) > 0)
											SET @HUBLINKTABLE_FINAL = @HUBLINKTABLE_FINAL + ' AND ' + @HUBLINKTABLE_TEMP
										ELSE
											SET @HUBLINKTABLE_FINAL = ' ON ' + @HUBLINKTABLE_TEMP

										SET @HUBLINKTABLE_TEMP = NULL
										-- END:: TABLE CREATION SECTION

										SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
									END
									--END:: COLUMNS PRESENT IN HUB AND LINK

									--START:: COLUMNS PRESENT IN LINK AND SATELLITE
									SET @PRIMARYKEYITERATOR_LINK = 1

									WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
									BEGIN
										SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
										SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

										PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

										-- START:: COLUMN CREATION SECTION
										SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
										SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
										SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

										WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
										BEGIN
											SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
											SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

											IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
												SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
											ELSE
												SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

											SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
										END

										--SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK
										SET @LINKSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @LINKSATCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_LINK
										SET @PRIMARYKEYVALUE_LINK_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_LINK_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_LINK_STAGING


										INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

										SET @LINKSATCOLUMN_TEMP = NULL
										-- END:: COLUMN CREATION SECTION

										SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
									END
									--END:: COLUMNS PRESENT IN LINK AND SATELLITE

									SET @PRIMARYKEYITERATORFORLINKTABLES = 1
		
									--START:: TABLES PRESENT IN LINK AND SATELLITE
									SET @PRIMARYKEYITERATORFORLINKTABLES = 1

									WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @LINKPRIMARYKEYCOUNTFORTABLES
									BEGIN
										SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
										SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

										PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

										-- START:: TABLE CREATION SECTION
										SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1 

										SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME)))
										--SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
										SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

										WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
										BEGIN
											SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
											SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

											IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
												SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
											ELSE
												SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

											SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
										END

										IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
											SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
										ELSE
											SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

										SET @LINKSATTABLE_TEMP = NULL
										-- END:: TABLE CREATION SECTION

										SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
									END
									--END:: TABLES PRESENT IN LINK AND SATELLITE
								END

					

							PRINT('@LINKSATTABLE_FINAL FOR HUB ' + @HUBNAME + ' IS ' + @LINKSATTABLE_FINAL)

							--START:: NON PRIMARY COLUMNS
							SET @NONPRIMARYKEYITERATOR = 1

							WHILE @NONPRIMARYKEYITERATOR <= @NONPRIMARYKEYCOUNT
							BEGIN
								SET @NONPRIMARYKEYVALUE = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )
								SET @NONPRIMARYKEYVALUE_STAGING = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )

								PRINT('@NONPRIMARYKEYVALUE:: ' + @NONPRIMARYKEYVALUE)

								SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
								SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

								IF NOT ((@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1) AND (CHARINDEX(@NONPRIMARYKEYVALUE,@NONPRIMARYCOLUMNLIST) > 1))
									BEGIN
										WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
										BEGIN
											SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
											SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

											IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
												SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
											ELSE
												SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

											SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
										END

										IF(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1)
											BEGIN
												SET @NONPRIMARYKEYCOLUMN_TEMP = 'COALESCE(' + @NONPRIMARYKEYCOLUMN_TEMP + ') AS ' + @TARGETFIELDNAME_NONPK_TEMP
											END
										ELSE
											BEGIN
												SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
											END

										--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
										--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

										--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

										SET @NONPRIMARYCOLUMNLIST = @NONPRIMARYCOLUMNLIST + @NONPRIMARYKEYVALUE
			
										INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)		
									END

								SET @NONPRIMARYKEYCOLUMN_TEMP = NULL

								SET @NONPRIMARYKEYITERATOR = @NONPRIMARYKEYITERATOR + 1
							END
							--END:: NON PRIMARY COLUMNS

							CREATE TABLE #TABLE_COLUMNSET_UPDATED WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT *,ROW_NUMBER() OVER (ORDER BY IDENTIFIER) AS ROW_NUM FROM #TABLE_COLUMNSET)

							SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1
							SET @RECORDCOUNTINTABLECOLUMNSET = (SELECT COUNT(IDENTIFIER) FROM #TABLE_COLUMNSET_UPDATED)
							SET @RECORDCOUNTINTABLECOLUMNSET = CAST(@RECORDCOUNTINTABLECOLUMNSET AS INT)

							WHILE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR <= @RECORDCOUNTINTABLECOLUMNSET
							BEGIN
								SET @COLUMNVALUE_RAWVAULT_TEMP = (SELECT TARGETFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)
								SET @COLUMNVALUE_STAGING_TEMP = (SELECT SOURCEFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)

								IF (CAST((SELECT LEN(@COLUMNVALUE_RAWVAULT_FINAL)) AS INT) > 0)
									SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_FINAL + ',' + @COLUMNVALUE_RAWVAULT_TEMP
								ELSE
									SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_TEMP 

								IF (CAST((SELECT LEN(@COLUMNVALUE_STAGING_FINAL)) AS INT) > 0)
									SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_FINAL + ',' + @COLUMNVALUE_STAGING_TEMP
								ELSE
									SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_TEMP

								PRINT('RECORD_COUNT_ITERATOR ' + CAST(@RECORDCOUNTINTABLECOLUMNSET_ITERATOR AS NVARCHAR) + ':: @COLUMNVALUE_RAWVAULT_TEMP: ' + @COLUMNVALUE_RAWVAULT_TEMP + '; @COLUMNVALUE_STAGING_TEMP: ' + @COLUMNVALUE_STAGING_TEMP)

								SET @COLUMNVALUE_RAWVAULT_TEMP = NULL
								SET @COLUMNVALUE_STAGING_TEMP = NULL

								SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = @RECORDCOUNTINTABLECOLUMNSET_ITERATOR + 1
							END

							PRINT('@COLUMNVALUE_RAWVAULT_FINAL:: ' + @COLUMNVALUE_RAWVAULT_FINAL)
							PRINT('@COLUMNVALUE_STAGING_FINAL:: ' + @COLUMNVALUE_STAGING_FINAL)

							SET @ALLPRIMARYKEYCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL + 'FROM ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME + ' INNER JOIN ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL 
							SET @ALLCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL
							SET @MERGEDHUBTABLE = @HUBDATACLASSIFICATION + '.' + @HUBNAME
							SET @MERGEDLINKTABLE = @LINKDATACLASSIFICATION + '.' + @LINKNAME
							SET @MERGEDSATTABLE = @SATDATACLASSIFICATION + '.' + @SATNAME

							PRINT('@ALLCOLUMNS:: ' + @ALLCOLUMNS)
							PRINT('@MERGEDHUBTABLE' + @MERGEDHUBTABLE)
							PRINT('@MERGEDLINKTABLE' + @MERGEDLINKTABLE)
							PRINT('@MERGEDSATTABLE' + @MERGEDSATTABLE)

							IF (@SATCOUNTUNDERLINK > 1)
								BEGIN
									SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDLINKTABLE + ' ' + @HUBLINKTABLE_FINAL + ' ' + @LINKSATTABLE_FINAL_UPDATED + ')')
								END
							ELSE
								BEGIN
									SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDLINKTABLE + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @LINKSATTABLE_FINAL + ')')
								END

							--SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDLINKTABLE + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @LINKSATTABLE_FINAL + ')')

							IF (CAST((SELECT LEN(@FINALRAWVAULTQUERY_FINAL)) AS INT) > 0)
								SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_FINAL + ' UNION ' + @FINALRAWVAULTQUERY_TEMP
							ELSE
								SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_TEMP

							PRINT('@HUBLINKCOLUMN_FINAL:: ' + @HUBLINKCOLUMN_FINAL)
							PRINT('@LINKSATCOLUMN_FINAL:: ' + @LINKSATCOLUMN_FINAL)
							PRINT('@NONPRIMARYKEYCOLUMN_FINAL:: ' + @NONPRIMARYKEYCOLUMN_FINAL)
							PRINT('@HUBLINKTABLE_FINAL:: ' + @HUBLINKTABLE_FINAL)
							PRINT('@LINKSATTABLE_FINAL:: ' + @LINKSATTABLE_FINAL)
							PRINT('@FINALRAWVAULTQUERY_TEMP:: ' + @FINALRAWVAULTQUERY_TEMP)
							PRINT('@FINALRAWVAULTQUERY_FINAL:: ' + @FINALRAWVAULTQUERY_FINAL)

		
							SET @UPDATEDSTAGINGCOLUMNVALUE = @COLUMNVALUE_STAGING_FINAL 
		

							SET @HUBLINKCOLUMN_FINAL = NULL
							SET @LINKSATCOLUMN_FINAL = NULL
							SET @NONPRIMARYKEYCOLUMN_FINAL = NULL
							SET @HUBLINKTABLE_FINAL = NULL
							SET @LINKSATTABLE_FINAL = NULL
							SET @ALLPRIMARYKEYCOLUMNS = NULL
							SET @ALLCOLUMNS = NULL
							SET @MERGEDHUBTABLE = NULL
							SET @MERGEDLINKTABLE = NULL
							SET @MERGEDSATTABLE = NULL
							SET @FINALRAWVAULTQUERY_TEMP = NULL
							SET @COLUMNVALUE_RAWVAULT_FINAL = NULL
							SET @COLUMNVALUE_STAGING_FINAL = NULL
					
							SET @ALLLINKUNDERHUBITERATOR = @ALLLINKUNDERHUBITERATOR + 1
						END
					END
				ELSE IF (@LINKCOUNT = 1)
					BEGIN
						SET @LINKNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS RESULTQUERY)
						SET @LINKDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)

						SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
						SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)

						PRINT('@LINKDATACLASSIFICATION.@LINKNAME:: ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME)

						SET @PRIMARYKEYITERATOR_HUB = 1

						--START:: COLUMNS PRESENT IN HUB AND LINK
						WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
						BEGIN
							SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
							SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

							PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

							-- START:: COLUMN CREATION SECTION
							SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = 1 
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB)
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK AS INT)

							WHILE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK
							BEGIN
								SET @TARGETFIELDNAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)
								SET @TARGETTABLENAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)

								IF (CAST((SELECT LEN(@HUBLINKCOLUMN_TEMP)) AS INT) > 0)
									SET @HUBLINKCOLUMN_TEMP = @HUBLINKCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP
								ELSE
									SET @HUBLINKCOLUMN_TEMP = @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP

								SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR +	1
							END

							--SET @HUBLINKCOLUMN_TEMP = 'COALESCE(' + @HUBLINKCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB
							SET @HUBLINKCOLUMN_TEMP = 'ISNULL(COALESCE(' + @HUBLINKCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_HUB
							SET @PRIMARYKEYVALUE_HUB_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_HUB_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_HUB_STAGING


							INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBLINKCOLUMN_TEMP)

							SET @HUBLINKCOLUMN_TEMP = NULL
							-- END:: COLUMN CREATION SECTION

							-- START:: TABLE CREATION SECTION
							SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = 1 

							SET @TARGETTABLECOUNT_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%'))
							SET @TARGETTABLECOUNT_HUBLINK = CAST(@TARGETTABLECOUNT_HUBLINK AS INT)

							WHILE @TARGETTABLECOUNT_HUBLINK_ITERATOR <= @TARGETTABLECOUNT_HUBLINK
							BEGIN
								SET @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)
								SET @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)

								IF (CAST((SELECT LEN(@HUBLINKTABLE_TEMP)) AS INT) > 0)
									SET @HUBLINKTABLE_TEMP = @HUBLINKTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP
								ELSE
									SET @HUBLINKTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP

								SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = @TARGETTABLECOUNT_HUBLINK_ITERATOR +	1
							END
			
							IF (CAST((SELECT LEN(@HUBLINKTABLE_FINAL)) AS INT) > 0)
								SET @HUBLINKTABLE_FINAL = @HUBLINKTABLE_FINAL + ' AND ' + @HUBLINKTABLE_TEMP
							ELSE
								SET @HUBLINKTABLE_FINAL = ' ON ' + @HUBLINKTABLE_TEMP

							SET @HUBLINKTABLE_TEMP = NULL
							-- END:: TABLE CREATION SECTION

							SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
						END
						--END:: COLUMNS PRESENT IN HUB AND LINK

						SET @PRIMARYKEYITERATOR_LINK = 1

						--START:: COLUMNS PRESENT IN LINK AND SATELLITE
						WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
						BEGIN
							SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
							SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

							PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

							-- START:: COLUMN CREATION SECTION
							SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

							WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
							BEGIN
								SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
								SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

								IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
									SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
								ELSE
									SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

								SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
							END

							--SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK
							SET @LINKSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @LINKSATCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_LINK
							SET @PRIMARYKEYVALUE_LINK_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_LINK_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_LINK_STAGING


							INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

							SET @LINKSATCOLUMN_TEMP = NULL
							-- END:: COLUMN CREATION SECTION

							SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
						END
						--END:: COLUMNS PRESENT IN LINK AND SATELLITE

						SET @SATCOUNTUNDERLINK = (SELECT COUNT(DISTINCT(RESULTQUERY.TARGETTABLENAME)) FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
						SET @SATCOUNTUNDERLINK = CAST(@SATCOUNTUNDERLINK AS INT)

						PRINT('@SATCOUNTUNDERLINK:: ' + @SATCOUNTUNDERLINK)

						SET @SATUNDERLINKITERATOR = 1

						IF (@SATCOUNTUNDERLINK > 1)
							BEGIN
								WHILE @SATUNDERLINKITERATOR <= @SATCOUNTUNDERLINK
								BEGIN
									SET @SATNAME = (SELECT FINALRESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY) AS FINALRESULTQUERY WHERE FINALRESULTQUERY.SEQUENCE LIKE @SATUNDERLINKITERATOR)
									SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

									PRINT('@SATDATACLASSIFICATION.@SATNAME:: ' + @SATDATACLASSIFICATION + '.' + @SATNAME)

									--SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1

									SET @PRIMARYKEYITERATORFORLINKTABLES = 1
									SET @SATPRIMARYKEYCOUNTUNDERTHELINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME)
									SET @SATPRIMARYKEYCOUNTUNDERTHELINK = CAST(@SATPRIMARYKEYCOUNTUNDERTHELINK AS INT)

									--START:: TABLES PRESENT IN LINK AND SATELLITE
									WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @SATPRIMARYKEYCOUNTUNDERTHELINK
									BEGIN
										SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
										SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @LINKNAME) AND TARGETTABLENAME LIKE @SATNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

										PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

										-- START:: TABLE CREATION SECTION
										SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1

										SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME)))
										--SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
										SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

										WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
										BEGIN
											SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
											SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

											IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
												SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
											ELSE
												SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

											SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
										END

										IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
											SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
										ELSE
											SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

										SET @LINKSATTABLE_TEMP = NULL
										-- END:: TABLE CREATION SECTION

										SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
									END
									--END:: TABLES PRESENT IN LINK AND SATELLITE

									IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL_UPDATED)) AS INT) > 0)
										SET @LINKSATTABLE_FINAL_UPDATED = @LINKSATTABLE_FINAL_UPDATED + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL
									ELSE
										SET @LINKSATTABLE_FINAL_UPDATED = ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL

									SET @LINKSATTABLE_FINAL = NULL

									SET @SATUNDERLINKITERATOR = @SATUNDERLINKITERATOR + 1
								END

								PRINT('@LINKSATTABLE_FINAL_UPDATED:: ' + @LINKSATTABLE_FINAL_UPDATED)

								PRINT('FULL QUERY OF HUB LINK AND SATELLITE TABLE:: ' + 'FROM ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME + ' INNER JOIN ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME + @LINKSATTABLE_FINAL_UPDATED)
							END
						ELSE
							BEGIN
								SET @SATNAME = (SELECT RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @LINKNAME)) AS RESULTQUERY)
								SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

								PRINT('@SATDATACLASSIFICATION.@SATNAME:: ' + @SATDATACLASSIFICATION + '.' + @SATNAME)

								--CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

								--CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

								--CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(2000),SOURCEFIELDNAME NVARCHAR(2000),TARGETFIELDNAME NVARCHAR(2000))

								SET @HUBPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'HUB%' AND TARGETTABLENAME LIKE @HUBNAME)
								SET @LINKPRIMARYKEYCOUNT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME))
								SET @LINKPRIMARYKEYCOUNTFORTABLES = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME)
								SET @NONPRIMARYKEYCOUNT = (SELECT COUNT(TARGETFIELDNAME) FROM #NONPRIMARYKEYRESULTSET)

								SET @PRIMARYKEYITERATOR_HUB = 1

								--START:: COLUMNS PRESENT IN HUB AND LINK
								WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
								BEGIN
									SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
									SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

									PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

									-- START:: COLUMN CREATION SECTION
									SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = 1 
			
									SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB)
									SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK AS INT)

									WHILE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBLINK
									BEGIN
										SET @TARGETFIELDNAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)
										SET @TARGETTABLENAME_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR)

										IF (CAST((SELECT LEN(@HUBLINKCOLUMN_TEMP)) AS INT) > 0)
											SET @HUBLINKCOLUMN_TEMP = @HUBLINKCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP
										ELSE
											SET @HUBLINKCOLUMN_TEMP = @TARGETTABLENAME_HUBLINK_TEMP + '.' + @TARGETFIELDNAME_HUBLINK_TEMP

										SET @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBLINK_ITERATOR +	1
									END

									--SET @HUBLINKCOLUMN_TEMP = 'COALESCE(' + @HUBLINKCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB
									SET @HUBLINKCOLUMN_TEMP = 'ISNULL(COALESCE(' + @HUBLINKCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_HUB
									SET @PRIMARYKEYVALUE_HUB_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_HUB_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_HUB_STAGING


									INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBLINKCOLUMN_TEMP)

									SET @HUBLINKCOLUMN_TEMP = NULL
									-- END:: COLUMN CREATION SECTION

									-- START:: TABLE CREATION SECTION
									SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = 1 

									SET @TARGETTABLECOUNT_HUBLINK = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%'))
									SET @TARGETTABLECOUNT_HUBLINK = CAST(@TARGETTABLECOUNT_HUBLINK AS INT)

									WHILE @TARGETTABLECOUNT_HUBLINK_ITERATOR <= @TARGETTABLECOUNT_HUBLINK
									BEGIN
										SET @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)
										SET @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBLINK_ITERATOR)

										IF (CAST((SELECT LEN(@HUBLINKTABLE_TEMP)) AS INT) > 0)
											SET @HUBLINKTABLE_TEMP = @HUBLINKTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP
										ELSE
											SET @HUBLINKTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBLINK_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBLINK_TEMP

										SET @TARGETTABLECOUNT_HUBLINK_ITERATOR = @TARGETTABLECOUNT_HUBLINK_ITERATOR +	1
									END
			
									IF (CAST((SELECT LEN(@HUBLINKTABLE_FINAL)) AS INT) > 0)
										SET @HUBLINKTABLE_FINAL = @HUBLINKTABLE_FINAL + ' AND ' + @HUBLINKTABLE_TEMP
									ELSE
										SET @HUBLINKTABLE_FINAL = ' ON ' + @HUBLINKTABLE_TEMP

									SET @HUBLINKTABLE_TEMP = NULL
									-- END:: TABLE CREATION SECTION

									SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
								END
								--END:: COLUMNS PRESENT IN HUB AND LINK

								SET @PRIMARYKEYITERATOR_LINK = 1

								--START:: COLUMNS PRESENT IN LINK AND SATELLITE
								WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
								BEGIN
									SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
									SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

									PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

									-- START:: COLUMN CREATION SECTION
									SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
									SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
									SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

									WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
									BEGIN
										SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
										SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

										IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
											SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
										ELSE
											SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

										SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
									END

									--SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK
									SET @LINKSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @LINKSATCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_LINK
									SET @PRIMARYKEYVALUE_LINK_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_LINK_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_LINK_STAGING


									INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

									SET @LINKSATCOLUMN_TEMP = NULL
									-- END:: COLUMN CREATION SECTION

									SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
								END
								--END:: COLUMNS PRESENT IN LINK AND SATELLITE

								SET @PRIMARYKEYITERATORFORLINKTABLES = 1
		
								--START:: TABLES PRESENT IN LINK AND SATELLITE
								WHILE @PRIMARYKEYITERATORFORLINKTABLES <= @LINKPRIMARYKEYCOUNTFORTABLES
								BEGIN
									SET @PRIMARYKEYVALUE_LINK_TABLEQUERY = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)
									SET @PRIMARYKEYVALUE_LINK_STAGING_TABLEQUERY = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATORFORLINKTABLES)

									PRINT('@@PRIMARYKEYVALUE_LINK_TABLEQUERY:: ' + @PRIMARYKEYVALUE_LINK_TABLEQUERY)

									-- START:: TABLE CREATION SECTION
									SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = 1

									SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME)))
									--SET @TARGETTABLECOUNT_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%'))
									SET @TARGETTABLECOUNT_LINKSAT = CAST(@TARGETTABLECOUNT_LINKSAT AS INT)

									WHILE @TARGETTABLECOUNT_LINKSAT_ITERATOR <= @TARGETTABLECOUNT_LINKSAT
									BEGIN
										SET @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)
										SET @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK_TABLEQUERY AND (TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ((TARGETTABLENAME LIKE @LINKNAME) OR (TARGETTABLENAME LIKE @SATNAME))) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_LINKSAT_ITERATOR)

										IF (CAST((SELECT LEN(@LINKSATTABLE_TEMP)) AS INT) > 0)
											SET @LINKSATTABLE_TEMP = @LINKSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP
										ELSE
											SET @LINKSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_LINKSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_LINKSAT_TEMP

										SET @TARGETTABLECOUNT_LINKSAT_ITERATOR = @TARGETTABLECOUNT_LINKSAT_ITERATOR +	1
									END

									IF (CAST((SELECT LEN(@LINKSATTABLE_FINAL)) AS INT) > 0)
										SET @LINKSATTABLE_FINAL = @LINKSATTABLE_FINAL + ' AND ' + @LINKSATTABLE_TEMP
									ELSE
										SET @LINKSATTABLE_FINAL = ' ON ' + @LINKSATTABLE_TEMP

									SET @LINKSATTABLE_TEMP = NULL
									-- END:: TABLE CREATION SECTION

									SET @PRIMARYKEYITERATORFORLINKTABLES = @PRIMARYKEYITERATORFORLINKTABLES + 1
								END
								--END:: TABLES PRESENT IN LINK AND SATELLITE
							END

						PRINT('@LINKSATTABLE_FINAL FOR HUB ' + @HUBNAME + ' IS ' + @LINKSATTABLE_FINAL)

						SET @NONPRIMARYKEYITERATOR = 1

						--START:: NON PRIMARY COLUMNS
						WHILE @NONPRIMARYKEYITERATOR <= @NONPRIMARYKEYCOUNT
						BEGIN
							SET @NONPRIMARYKEYVALUE = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )
							SET @NONPRIMARYKEYVALUE_STAGING = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )

							PRINT('@NONPRIMARYKEYVALUE:: ' + @NONPRIMARYKEYVALUE)

							--SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
							--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
							--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

							--WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
							--BEGIN
							--	SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
							--	SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

							--	IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
							--		SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
							--	ELSE
							--		SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

							--	SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
							--END

							--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
							--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

							--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
			
							--INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)

							SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

							IF NOT ((@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1) AND (CHARINDEX(@NONPRIMARYKEYVALUE,@NONPRIMARYCOLUMNLIST) > 1))
								BEGIN
									WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
									BEGIN
										SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
										SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

										IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
											SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
										ELSE
											SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

										SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
									END

									IF(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1)
										BEGIN
											SET @NONPRIMARYKEYCOLUMN_TEMP = 'COALESCE(' + @NONPRIMARYKEYCOLUMN_TEMP + ') AS ' + @TARGETFIELDNAME_NONPK_TEMP
										END
									ELSE
										BEGIN
											SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
										END

									--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
									--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

									--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

									SET @NONPRIMARYCOLUMNLIST = @NONPRIMARYCOLUMNLIST + @NONPRIMARYKEYVALUE
			
									INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)		
								END

							SET @NONPRIMARYKEYCOLUMN_TEMP = NULL

							SET @NONPRIMARYKEYITERATOR = @NONPRIMARYKEYITERATOR + 1
						END
						--END:: NON PRIMARY COLUMNS

						CREATE TABLE #TABLE_COLUMNSET_UPDATED WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT *,ROW_NUMBER() OVER (ORDER BY IDENTIFIER) AS ROW_NUM FROM #TABLE_COLUMNSET)

						SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1
						SET @RECORDCOUNTINTABLECOLUMNSET = (SELECT COUNT(IDENTIFIER) FROM #TABLE_COLUMNSET_UPDATED)
						SET @RECORDCOUNTINTABLECOLUMNSET = CAST(@RECORDCOUNTINTABLECOLUMNSET AS INT)

						WHILE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR <= @RECORDCOUNTINTABLECOLUMNSET
						BEGIN
					
							SET @COLUMNVALUE_RAWVAULT_TEMP = (SELECT TARGETFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)
							SET @COLUMNVALUE_STAGING_TEMP = (SELECT SOURCEFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)

							IF (CAST((SELECT LEN(@COLUMNVALUE_RAWVAULT_FINAL)) AS INT) > 0)
								SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_FINAL + ',' + @COLUMNVALUE_RAWVAULT_TEMP
							ELSE
								SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_TEMP 

							IF (CAST((SELECT LEN(@COLUMNVALUE_STAGING_FINAL)) AS INT) > 0)
								SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_FINAL + ',' + @COLUMNVALUE_STAGING_TEMP
							ELSE
								SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_TEMP

							PRINT('RECORD_COUNT_ITERATOR ' + CAST(@RECORDCOUNTINTABLECOLUMNSET_ITERATOR AS NVARCHAR) + ':: @COLUMNVALUE_RAWVAULT_TEMP: ' + @COLUMNVALUE_RAWVAULT_TEMP + '; @COLUMNVALUE_STAGING_TEMP: ' + @COLUMNVALUE_STAGING_TEMP)

							SET @COLUMNVALUE_RAWVAULT_TEMP = NULL
							SET @COLUMNVALUE_STAGING_TEMP = NULL

							SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = @RECORDCOUNTINTABLECOLUMNSET_ITERATOR + 1
						END

						PRINT('@COLUMNVALUE_RAWVAULT_FINAL:: ' + @COLUMNVALUE_RAWVAULT_FINAL)
						PRINT('@COLUMNVALUE_STAGING_FINAL:: ' + @COLUMNVALUE_STAGING_FINAL)

						SET @ALLPRIMARYKEYCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL + 'FROM ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME + ' INNER JOIN ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL 
						SET @ALLCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL
						SET @MERGEDHUBTABLE = @HUBDATACLASSIFICATION + '.' + @HUBNAME
						SET @MERGEDLINKTABLE = @LINKDATACLASSIFICATION + '.' + @LINKNAME
						SET @MERGEDSATTABLE = @SATDATACLASSIFICATION + '.' + @SATNAME

						PRINT('@ALLCOLUMNS:: ' + @ALLCOLUMNS)
						PRINT('@MERGEDHUBTABLE' + @MERGEDHUBTABLE)
						PRINT('@MERGEDLINKTABLE' + @MERGEDLINKTABLE)
						PRINT('@MERGEDSATTABLE' + @MERGEDSATTABLE)

						IF (@SATCOUNTUNDERLINK > 1)
							BEGIN
								SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDLINKTABLE + ' ' + @HUBLINKTABLE_FINAL + ' ' + @LINKSATTABLE_FINAL_UPDATED + ')')
							END
						ELSE
							BEGIN
								SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDLINKTABLE + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @LINKSATTABLE_FINAL + ')')
							END

						IF (CAST((SELECT LEN(@FINALRAWVAULTQUERY_FINAL)) AS INT) > 0)
							SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_FINAL + ' UNION ' + @FINALRAWVAULTQUERY_TEMP
						ELSE
							SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_TEMP

						PRINT('@HUBLINKCOLUMN_FINAL:: ' + @HUBLINKCOLUMN_FINAL)
						PRINT('@LINKSATCOLUMN_FINAL:: ' + @LINKSATCOLUMN_FINAL)
						PRINT('@NONPRIMARYKEYCOLUMN_FINAL:: ' + @NONPRIMARYKEYCOLUMN_FINAL)
						PRINT('@HUBLINKTABLE_FINAL:: ' + @HUBLINKTABLE_FINAL)
						PRINT('@LINKSATTABLE_FINAL:: ' + @LINKSATTABLE_FINAL)
						PRINT('@FINALRAWVAULTQUERY_TEMP:: ' + @FINALRAWVAULTQUERY_TEMP)
						PRINT('@FINALRAWVAULTQUERY_FINAL:: ' + @FINALRAWVAULTQUERY_FINAL)

		
						SET @UPDATEDSTAGINGCOLUMNVALUE = @COLUMNVALUE_STAGING_FINAL 
		

						SET @HUBLINKCOLUMN_FINAL = NULL
						SET @LINKSATCOLUMN_FINAL = NULL
						SET @NONPRIMARYKEYCOLUMN_FINAL = NULL
						SET @HUBLINKTABLE_FINAL = NULL
						SET @LINKSATTABLE_FINAL = NULL
						SET @ALLPRIMARYKEYCOLUMNS = NULL
						SET @ALLCOLUMNS = NULL
						SET @MERGEDHUBTABLE = NULL
						SET @MERGEDLINKTABLE = NULL
						SET @MERGEDSATTABLE = NULL
						SET @FINALRAWVAULTQUERY_TEMP = NULL
						SET @COLUMNVALUE_RAWVAULT_FINAL = NULL
						SET @COLUMNVALUE_STAGING_FINAL = NULL
						SET @LINKSATTABLE_FINAL_UPDATED = NULL
					END

				ELSE IF (@LINKCOUNT = 0)
					BEGIN
						SET @SATCOUNTUNDERLINK = (SELECT COUNT(DISTINCT(RESULTQUERY.TARGETTABLENAME)) FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS RESULTQUERY)
						SET @SATCOUNTUNDERLINK = CAST(@SATCOUNTUNDERLINK AS INT)

						PRINT('@SATCOUNTUNDERLINK:: ' + @SATCOUNTUNDERLINK)

						SET @SATNAME = (SELECT FINALRESULTQUERY.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,RESULTQUERY.TARGETTABLENAME FROM (SELECT DISTINCT(TARGETTABLENAME) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE 'SAT%' AND TARGETFIELDNAME IN (SELECT TARGETFIELDNAME FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS RESULTQUERY) AS FINALRESULTQUERY)
						SET @SATDATACLASSIFICATION = (SELECT DISTINCT(TARGETSCHEMA) FROM #TABLE_WORKINGSET WHERE TARGETTABLENAME LIKE @SATNAME)

						PRINT('@SATDATACLASSIFICATION.@SATNAME:: ' + @SATDATACLASSIFICATION + '.' + @SATNAME)

						/*CREATE TABLE #PRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY LIKE 'YES') AS RESULTQUERY)

						CREATE TABLE #NONPRIMARYKEYRESULTSET WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT RESULTQUERY.TARGETTABLENAME, RESULTQUERY.TARGETFIELDNAME,RESULTQUERY.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETTABLENAME,TARGETFIELDNAME,SOURCEFIELDNAME FROM #TABLE_WORKINGSET WHERE (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'LINK%' OR TARGETTABLENAME LIKE 'SAT%') AND ISPRIMARYKEY IS NULL) AS RESULTQUERY)

						CREATE TABLE #TABLE_COLUMNSET (IDENTIFIER NVARCHAR(2000),SOURCEFIELDNAME NVARCHAR(2000),TARGETFIELDNAME NVARCHAR(2000))*/
				
						SET @PRIMARYKEYITERATOR_HUB = 1
						
						--START:: COLUMNS PRESENT IN HUB AND SAT
						WHILE @PRIMARYKEYITERATOR_HUB <= @HUBPRIMARYKEYCOUNT
						BEGIN
							SET @PRIMARYKEYVALUE_HUB = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )
							SET @PRIMARYKEYVALUE_HUB_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_HUB )

							PRINT('@PRIMARYKEYVALUE_HUB:: ' + @PRIMARYKEYVALUE_HUB)

							-- START:: COLUMN CREATION SECTION
							SET @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR = 1 
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB)
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT AS INT)

							WHILE @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_HUBSAT
							BEGIN
								SET @TARGETFIELDNAME_HUBSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR)
								SET @TARGETTABLENAME_HUBSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR)

								IF (CAST((SELECT LEN(@HUBSATCOLUMN_TEMP)) AS INT) > 0)
									SET @HUBSATCOLUMN_TEMP = @HUBSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_HUBSAT_TEMP + '.' + @TARGETFIELDNAME_HUBSAT_TEMP
								ELSE
									SET @HUBSATCOLUMN_TEMP = @TARGETTABLENAME_HUBSAT_TEMP + '.' + @TARGETFIELDNAME_HUBSAT_TEMP

								SET @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_HUBSAT_ITERATOR + 1
							END

							--SET @HUBSATCOLUMN_TEMP = 'COALESCE(' + @HUBSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_HUB
							SET @HUBSATCOLUMN_TEMP = 'ISNULL(COALESCE(' + @HUBSATCOLUMN_TEMP + '),'''') AS ' + @PRIMARYKEYVALUE_HUB
							SET @PRIMARYKEYVALUE_HUB_STAGING = 'ISNULL(' + @PRIMARYKEYVALUE_HUB_STAGING + ','''') AS ' + @PRIMARYKEYVALUE_HUB_STAGING

							PRINT('@HUBSATCOLUMN_TEMP:: ' + @HUBSATCOLUMN_TEMP)

							INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_HUB,@PRIMARYKEYVALUE_HUB_STAGING,@HUBSATCOLUMN_TEMP)

							SET @HUBSATCOLUMN_TEMP = NULL
							-- END:: COLUMN CREATION SECTION

							-- START:: TABLE CREATION SECTION
							SET @TARGETTABLECOUNT_HUBSAT_ITERATOR = 1 

							SET @TARGETTABLECOUNT_HUBSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'SAT%'))
							SET @TARGETTABLECOUNT_HUBSAT = CAST(@TARGETTABLECOUNT_HUBSAT AS INT)

							WHILE @TARGETTABLECOUNT_HUBSAT_ITERATOR <= @TARGETTABLECOUNT_HUBSAT
							BEGIN
								SET @TARGETFIELDNAMEFORTABLE_HUBSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBSAT_ITERATOR)
								SET @TARGETTABLENAMEFORTABLE_HUBSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_HUB AND (TARGETTABLENAME LIKE 'HUB%' OR TARGETTABLENAME LIKE 'SAT%')) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETTABLECOUNT_HUBSAT_ITERATOR)

								IF (CAST((SELECT LEN(@HUBSATTABLE_TEMP)) AS INT) > 0)
									SET @HUBSATTABLE_TEMP = @HUBSATTABLE_TEMP + ' = ' + @TARGETTABLENAMEFORTABLE_HUBSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBSAT_TEMP
								ELSE
									SET @HUBSATTABLE_TEMP = @TARGETTABLENAMEFORTABLE_HUBSAT_TEMP + '.' + @TARGETFIELDNAMEFORTABLE_HUBSAT_TEMP

								SET @TARGETTABLECOUNT_HUBSAT_ITERATOR = @TARGETTABLECOUNT_HUBSAT_ITERATOR +	1
							END
			
							IF (CAST((SELECT LEN(@HUBSATTABLE_FINAL)) AS INT) > 0)
								SET @HUBSATTABLE_FINAL = @HUBSATTABLE_FINAL + ' AND ' + @HUBSATTABLE_TEMP
							ELSE
								SET @HUBSATTABLE_FINAL = ' ON ' + @HUBSATTABLE_TEMP

							SET @HUBSATTABLE_TEMP = NULL
							-- END:: TABLE CREATION SECTION

							SET @PRIMARYKEYITERATOR_HUB = @PRIMARYKEYITERATOR_HUB + 1
						END
						--END:: COLUMNS PRESENT IN HUB AND LINK

						/*--START:: COLUMNS PRESENT IN LINK AND SATELLITE
						WHILE @PRIMARYKEYITERATOR_LINK <= @LINKPRIMARYKEYCOUNT
						BEGIN
							SET @PRIMARYKEYVALUE_LINK = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)
							SET @PRIMARYKEYVALUE_LINK_STAGING = (SELECT TEMP_TABLE.SOURCEFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME,SOURCEFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE 'LINK%' AND TARGETTABLENAME LIKE @LINKNAME AND TARGETFIELDNAME NOT IN (SELECT TARGETFIELDNAME FROM #PRIMARYKEYRESULTSET WHERE TARGETTABLENAME LIKE @HUBNAME)) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @PRIMARYKEYITERATOR_LINK)

							PRINT('@PRIMARYKEYVALUE_LINK:: ' + @PRIMARYKEYVALUE_LINK)

							-- START:: COLUMN CREATION SECTION
							SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = 1
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = (SELECT COUNT(TARGETTABLENAME) FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%')
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT AS INT)

							WHILE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_LINKSAT
							BEGIN
								SET @TARGETFIELDNAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)
								SET @TARGETTABLENAME_LINKSAT_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #PRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @PRIMARYKEYVALUE_LINK AND TARGETTABLENAME NOT LIKE 'HUB%') AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR)

								IF (CAST((SELECT LEN(@LINKSATCOLUMN_TEMP)) AS INT) > 0)
									SET @LINKSATCOLUMN_TEMP = @LINKSATCOLUMN_TEMP + ',' + @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP
								ELSE
									SET @LINKSATCOLUMN_TEMP = @TARGETTABLENAME_LINKSAT_TEMP + '.' + @TARGETFIELDNAME_LINKSAT_TEMP

								SET @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_LINKSAT_ITERATOR +	1
							END

							SET @LINKSATCOLUMN_TEMP = 'COALESCE(' + @LINKSATCOLUMN_TEMP + ') AS ' + @PRIMARYKEYVALUE_LINK


							INSERT INTO #TABLE_COLUMNSET VALUES(@PRIMARYKEYVALUE_LINK,@PRIMARYKEYVALUE_LINK_STAGING,@LINKSATCOLUMN_TEMP)

							SET @LINKSATCOLUMN_TEMP = NULL
							-- END:: COLUMN CREATION SECTION

							SET @PRIMARYKEYITERATOR_LINK = @PRIMARYKEYITERATOR_LINK + 1
						END
						--END:: COLUMNS PRESENT IN LINK AND SATELLITE*/

						--START:: NON PRIMARY COLUMNS
						SET @NONPRIMARYKEYITERATOR = 1

						WHILE @NONPRIMARYKEYITERATOR <= @NONPRIMARYKEYCOUNT
						BEGIN
							SET @NONPRIMARYKEYVALUE = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )
							SET @NONPRIMARYKEYVALUE_STAGING = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,SOURCEFIELDNAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR )

							PRINT('@NONPRIMARYKEYVALUE:: ' + @NONPRIMARYKEYVALUE)

							--SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
							--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
							--SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

							--WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
							--BEGIN
							--	SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
							--	SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

							--	IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
							--		SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
							--	ELSE
							--		SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

							--	SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
							--END

							--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
							--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

							--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
			
							--INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)

							SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = 1
			
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = (SELECT COUNT(TARGETTABLENAME) FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE)
							SET @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK = CAST(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK AS INT)

							IF NOT ((@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1) AND (CHARINDEX(@NONPRIMARYKEYVALUE,@NONPRIMARYCOLUMNLIST) > 1))
								BEGIN
									WHILE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR <= @TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK
									BEGIN
										SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)
										SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET WHERE TARGETFIELDNAME LIKE @NONPRIMARYKEYVALUE) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR)

										IF (CAST((SELECT LEN(@NONPRIMARYKEYCOLUMN_TEMP)) AS INT) > 0)
											SET @NONPRIMARYKEYCOLUMN_TEMP = @NONPRIMARYKEYCOLUMN_TEMP + ',' + @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
										ELSE
											SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

										SET @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR = @TARGETFIELDWITHCURRENTFIELD_NONPK_ITERATOR +	1
									END

									IF(@TARGETFIELDCOUNTWITHCURRENTFIELD_NONPK > 1)
										BEGIN
											SET @NONPRIMARYKEYCOLUMN_TEMP = 'COALESCE(' + @NONPRIMARYKEYCOLUMN_TEMP + ') AS ' + @TARGETFIELDNAME_NONPK_TEMP
										END
									ELSE
										BEGIN
											SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP
										END

									--SET @TARGETFIELDNAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETFIELDNAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)
									--SET @TARGETTABLENAME_NONPK_TEMP = (SELECT TEMP_TABLE.TARGETTABLENAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,TARGETFIELDNAME,TARGETTABLENAME FROM #NONPRIMARYKEYRESULTSET) AS TEMP_TABLE WHERE TEMP_TABLE.SEQUENCE LIKE @NONPRIMARYKEYITERATOR)

									--SET @NONPRIMARYKEYCOLUMN_TEMP = @TARGETTABLENAME_NONPK_TEMP + '.' + @TARGETFIELDNAME_NONPK_TEMP

									SET @NONPRIMARYCOLUMNLIST = @NONPRIMARYCOLUMNLIST + @NONPRIMARYKEYVALUE
			
									INSERT INTO #TABLE_COLUMNSET VALUES(@NONPRIMARYKEYVALUE,@NONPRIMARYKEYVALUE_STAGING,@NONPRIMARYKEYCOLUMN_TEMP)		
								END

							SET @NONPRIMARYKEYCOLUMN_TEMP = NULL

							SET @NONPRIMARYKEYITERATOR = @NONPRIMARYKEYITERATOR + 1
						END
						--END:: NON PRIMARY COLUMNS

						CREATE TABLE #TABLE_COLUMNSET_UPDATED WITH (DISTRIBUTION = ROUND_ROBIN) AS (SELECT *,ROW_NUMBER() OVER (ORDER BY IDENTIFIER) AS ROW_NUM FROM #TABLE_COLUMNSET)

						SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = 1
						SET @RECORDCOUNTINTABLECOLUMNSET = (SELECT COUNT(IDENTIFIER) FROM #TABLE_COLUMNSET_UPDATED)
						SET @RECORDCOUNTINTABLECOLUMNSET = CAST(@RECORDCOUNTINTABLECOLUMNSET AS INT)

						WHILE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR <= @RECORDCOUNTINTABLECOLUMNSET
						BEGIN
					
							SET @COLUMNVALUE_RAWVAULT_TEMP = (SELECT TARGETFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)
							SET @COLUMNVALUE_STAGING_TEMP = (SELECT SOURCEFIELDNAME FROM #TABLE_COLUMNSET_UPDATED WHERE ROW_NUM LIKE @RECORDCOUNTINTABLECOLUMNSET_ITERATOR)

							IF (CAST((SELECT LEN(@COLUMNVALUE_RAWVAULT_FINAL)) AS INT) > 0)
								SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_FINAL + ',' + @COLUMNVALUE_RAWVAULT_TEMP
							ELSE
								SET @COLUMNVALUE_RAWVAULT_FINAL = @COLUMNVALUE_RAWVAULT_TEMP 

							IF (CAST((SELECT LEN(@COLUMNVALUE_STAGING_FINAL)) AS INT) > 0)
								SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_FINAL + ',' + @COLUMNVALUE_STAGING_TEMP
							ELSE
								SET @COLUMNVALUE_STAGING_FINAL = @COLUMNVALUE_STAGING_TEMP

							PRINT('RECORD_COUNT_ITERATOR ' + CAST(@RECORDCOUNTINTABLECOLUMNSET_ITERATOR AS NVARCHAR) + ':: @COLUMNVALUE_RAWVAULT_TEMP: ' + @COLUMNVALUE_RAWVAULT_TEMP + '; @COLUMNVALUE_STAGING_TEMP: ' + @COLUMNVALUE_STAGING_TEMP)

							SET @COLUMNVALUE_RAWVAULT_TEMP = NULL
							SET @COLUMNVALUE_STAGING_TEMP = NULL

							SET @RECORDCOUNTINTABLECOLUMNSET_ITERATOR = @RECORDCOUNTINTABLECOLUMNSET_ITERATOR + 1
						END

						PRINT('@COLUMNVALUE_RAWVAULT_FINAL:: ' + @COLUMNVALUE_RAWVAULT_FINAL)
						PRINT('@COLUMNVALUE_STAGING_FINAL:: ' + @COLUMNVALUE_STAGING_FINAL)

						SET @ALLPRIMARYKEYCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL + 'FROM ' + @HUBDATACLASSIFICATION + '.' + @HUBNAME + ' INNER JOIN ' + @LINKDATACLASSIFICATION + '.' + @LINKNAME + ' ' + @HUBLINKTABLE_FINAL + ' INNER JOIN ' + @SATDATACLASSIFICATION + '.' + @SATNAME + ' ' + @LINKSATTABLE_FINAL 
						SET @ALLCOLUMNS = @HUBLINKCOLUMN_FINAL + ',' + @LINKSATCOLUMN_FINAL + ',' + @NONPRIMARYKEYCOLUMN_FINAL
						SET @MERGEDHUBTABLE = @HUBDATACLASSIFICATION + '.' + @HUBNAME
						SET @MERGEDLINKTABLE = @LINKDATACLASSIFICATION + '.' + @LINKNAME
						SET @MERGEDSATTABLE = @SATDATACLASSIFICATION + '.' + @SATNAME

						PRINT('@ALLCOLUMNS:: ' + @ALLCOLUMNS)
						PRINT('@MERGEDHUBTABLE' + @MERGEDHUBTABLE)
						PRINT('@MERGEDLINKTABLE' + @MERGEDLINKTABLE)
						PRINT('@MERGEDSATTABLE' + @MERGEDSATTABLE)

						IF (@SATCOUNTUNDERLINK > 1)
							BEGIN
								SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @HUBSATTABLE_FINAL + ')')
							END
						ELSE
							BEGIN
								SET @FINALRAWVAULTQUERY_TEMP = ('(' + 'SELECT ' + @COLUMNVALUE_RAWVAULT_FINAL + ' FROM ' + @MERGEDHUBTABLE + ' INNER JOIN ' + @MERGEDSATTABLE + ' ' + @HUBSATTABLE_FINAL + ')')
							END

						IF (CAST((SELECT LEN(@FINALRAWVAULTQUERY_FINAL)) AS INT) > 0)
							SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_FINAL + ' UNION ' + @FINALRAWVAULTQUERY_TEMP
						ELSE
							SET @FINALRAWVAULTQUERY_FINAL = @FINALRAWVAULTQUERY_TEMP

						PRINT('@HUBLINKCOLUMN_FINAL:: ' + @HUBLINKCOLUMN_FINAL)
						PRINT('@LINKSATCOLUMN_FINAL:: ' + @LINKSATCOLUMN_FINAL)
						PRINT('@NONPRIMARYKEYCOLUMN_FINAL:: ' + @NONPRIMARYKEYCOLUMN_FINAL)
						PRINT('@HUBLINKTABLE_FINAL:: ' + @HUBLINKTABLE_FINAL)
						PRINT('@LINKSATTABLE_FINAL:: ' + @LINKSATTABLE_FINAL)
						PRINT('@FINALRAWVAULTQUERY_TEMP:: ' + @FINALRAWVAULTQUERY_TEMP)
						PRINT('@FINALRAWVAULTQUERY_FINAL:: ' + @FINALRAWVAULTQUERY_FINAL)

		
						SET @UPDATEDSTAGINGCOLUMNVALUE = @COLUMNVALUE_STAGING_FINAL 
		

						SET @HUBLINKCOLUMN_FINAL = NULL
						SET @LINKSATCOLUMN_FINAL = NULL
						SET @NONPRIMARYKEYCOLUMN_FINAL = NULL
						SET @HUBLINKTABLE_FINAL = NULL
						SET @LINKSATTABLE_FINAL = NULL
						SET @ALLPRIMARYKEYCOLUMNS = NULL
						SET @ALLCOLUMNS = NULL
						SET @MERGEDHUBTABLE = NULL
						SET @MERGEDLINKTABLE = NULL
						SET @MERGEDSATTABLE = NULL
						SET @FINALRAWVAULTQUERY_TEMP = NULL
						SET @COLUMNVALUE_RAWVAULT_FINAL = NULL
						SET @COLUMNVALUE_STAGING_FINAL = NULL
						SET @LINKSATTABLE_FINAL_UPDATED = NULL
					END

				SET @HUBITERATOR = @HUBITERATOR + 1;
			END
		END

	DECLARE @STAGINGTABLECOUNTFORASOURCE NVARCHAR(MAX)
	DECLARE @STAGINGTABLEINSTANCE NVARCHAR(MAX)
	DECLARE @STAGINGQUERYINSTANCE NVARCHAR(MAX)
	DECLARE @STAGINGTABLEITERATOR INT = 1

	SET @STAGINGTABLECOUNTFORASOURCE = (SELECT COUNT(NAME) FROM SYS.TABLES WHERE NAME LIKE('STG%' + @SOURCETABLE + '[_]%'))
	SET @STAGINGTABLECOUNTFORASOURCE = CAST(@STAGINGTABLECOUNTFORASOURCE AS INT)

	WHILE @STAGINGTABLEITERATOR <= @STAGINGTABLECOUNTFORASOURCE
	BEGIN
		SET @STAGINGTABLEINSTANCE = (SELECT TEMP_TABLE.NAME FROM (SELECT ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) AS SEQUENCE,NAME FROM SYS.TABLES WHERE NAME LIKE('STG%' + @SOURCETABLE + '[_]%')) AS TEMP_TABLE WHERE SEQUENCE = @STAGINGTABLEITERATOR)

		--SET @STAGINGQUERYINSTANCE = '(SELECT ' + @FINALSTAGINGQUERYFORCOLUMNS + ' FROM STAGING.' +  @STAGINGTABLEINSTANCE + ')'
		SET @STAGINGQUERYINSTANCE = '(SELECT ' + @UPDATEDSTAGINGCOLUMNVALUE + ' FROM STAGING.' +  @STAGINGTABLEINSTANCE + ')'

		IF (CAST((SELECT LEN(@FINALSTAGINGQUERY)) AS INT) > 0)
			SET @FINALSTAGINGQUERY = @FINALSTAGINGQUERY + ' UNION ' + @STAGINGQUERYINSTANCE
		ELSE
			SET @FINALSTAGINGQUERY = @STAGINGQUERYINSTANCE

		SET @STAGINGTABLEITERATOR = @STAGINGTABLEITERATOR + 1
	END;

	SET @FINALSTAGINGQUERY = '(' + @FINALSTAGINGQUERY + ')'
	SET @FINALRAWVAULTQUERY_FINAL = '(' + @FINALRAWVAULTQUERY_FINAL + ')'
	SET @UPDATEDFINALRVQUERYFORALLHUB = '(' + @UPDATEDFINALRVQUERYFORALLHUB + ')'

	PRINT '**********STAGING TABLE QUERY**********'
	PRINT @FINALSTAGINGQUERY

	PRINT(' ')

	PRINT '**********HUB,LINK,SATELLITE TABLE QUERY**********'
	--PRINT @UPDATEDFINALRVQUERYFORALLHUB
	IF (CAST((SELECT LEN(@FINALRAWVAULTQUERY_FINAL)) AS INT) > 0)
		BEGIN
			PRINT(SUBSTRING(@FINALRAWVAULTQUERY_FINAL,1,4000))
			PRINT(SUBSTRING(@FINALRAWVAULTQUERY_FINAL,4001,4000))
		END
	ELSE
		BEGIN
			PRINT @FINALRAWVAULTQUERY_FINAL
		END

	PRINT(' ')

	PRINT('**********STAGING MINUS HUB,LINK,SATELLITE**********')
	PRINT @FINALSTAGINGQUERY + ' EXCEPT ' + @FINALRAWVAULTQUERY_FINAL
	EXECUTE (@FINALSTAGINGQUERY + ' EXCEPT ' + @FINALRAWVAULTQUERY_FINAL)

	PRINT(' ')
	
	PRINT('**********HUB,LINK,SATELLITE MINUS STAGING**********')
	PRINT @FINALRAWVAULTQUERY_FINAL + ' EXCEPT ' + @FINALSTAGINGQUERY
	EXECUTE (@FINALRAWVAULTQUERY_FINAL + ' EXCEPT ' + @FINALSTAGINGQUERY)

	BEGIN TRY
		DROP TABLE #TABLE_WORKINGSET
	END TRY
	BEGIN CATCH
		PRINT '#TABLE_WORKINGSET IS NOT PRESENT IN THE SCHEMA'
	END CATCH;

	BEGIN TRY
		DROP TABLE #QUERYBUILDER
	END TRY
	BEGIN CATCH
		PRINT '#QUERYBUILDER IS NOT PRESENT IN THE SCHEMA'
	END CATCH;

	BEGIN TRY
		DROP TABLE #OTHERTHANPKQUERYBUILDER
	END TRY
	BEGIN CATCH
		PRINT '#OTHERTHANPKQUERYBUILDER IS NOT PRESENT IN THE SCHEMA'
	END CATCH;
END
